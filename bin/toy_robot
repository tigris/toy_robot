#!/usr/bin/env ruby

file   = __FILE__
file   = File.readlink(file) while File.symlink?(file) # Avoid putting same end path in load_path twice via symlinks
libdir = File.expand_path(File.join(File.dirname(file), '..', 'lib'))
$LOAD_PATH.unshift(libdir) unless $LOAD_PATH.include?(libdir)

require 'toy_robot'

def parse_command robot, command
  args = case command.chomp
    when 'LEFT';   [:turn, :left]
    when 'RIGHT';  [:turn, :right]
    when 'MOVE';   :move
    when 'REPORT'; :report
    when /PLACE (\d),(\d),(\w+)/; [:place, Regexp.last_match[1].to_i, Regexp.last_match[2].to_i, Regexp.last_match[3]]
  end
  val = robot.send(*args)
  puts val if args == :report
end

robot = ToyRobot.new
File.readlines(ARGV[0]).each{|line| parse_command(robot, line) }
